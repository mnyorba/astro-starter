---
import Layout from "../layouts/Layout.astro";
import ContactValue from "../components/common/ContactValue.astro";
import { default as contacts } from "../data/contacts.json";
import ContactForm from "../components/contact/ContactForm.astro";

const title = "Contacts";
const description =
  "Get in touch through any preferred method. I'm always open to new opportunities and collaborative projects.";

const sections = {
  general: "General Information",
  social: "Social Media",
  location: "Location",
};
---

<Layout title={title} description={description}>
  <section class="animate-fade-down">
    <header class="mb-8 text-center">
      <h1>{title}</h1>
      <p class="text-lg font-semibold">{description}</p>
    </header>
    <div class="grid-cols-(repeat(auto-fill, minmax(10rem, 1fr)) grid">
      <!-- Each contact item will be generated below -->
      {
        contacts.map((contact, index) => (
          <div
            id={index.toString()}
            class="mx-auto grid w-full max-w-7xl grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-3"
          >
            {Object.entries(contact).map(([sectionKey, sectionData]) => (
              <div
                id={sectionKey}
                class="card bg-base-200 p-4 shadow-lg ring-1 ring-black/5"
              >
                <div class="card-body">
                  <div class="card-title flex flex-col">
                    <h2 class="mt-4 mb-1 capitalize">
                      {sections[sectionKey as keyof typeof sections]}
                    </h2>
                    <div class="divider" />
                  </div>
                  {Object.entries(sectionData).map(([key, value]) => {
                    let title = "";
                    let data;
                    let displayText: string | null = null;

                    if (Array.isArray(value)) {
                      // Handling different array formats
                      if (value.length === 3) {
                        // [title, data, displayText]
                        title = typeof value[0] === "string" ? value[0] : "";
                        data = value[1];
                        displayText =
                          typeof value[2] === "string" ? value[2] : null;
                      } else if (value.length === 2) {
                        // Check if second element is an array (working hours format)
                        if (Array.isArray(value[1])) {
                          // [title, [array of hours]]
                          title = typeof value[0] === "string" ? value[0] : "";
                          data = value[1]; // This is an array of hours
                          displayText = null;
                        } else {
                          // [data, displayText] or [title, data]
                          // Check if the first element is a title
                          if (
                            value[0] &&
                            typeof value[0] === "string" &&
                            !value[0].startsWith("http") &&
                            !value[0].startsWith("mailto:") &&
                            !value[0].startsWith("tel:")
                          ) {
                            title = value[0];
                            data = value[1];
                            displayText = null;
                          } else {
                            data = value[0];
                            displayText =
                              typeof value[1] === "string" ? value[1] : null;
                          }
                        }
                      } else if (value.length === 1) {
                        // [data]
                        data = value[0];
                        displayText = null;
                      }
                    } else if (typeof value === "string") {
                      data = value;
                      displayText = null;
                    }

                    return (
                      <div id={key} class="mb-2">
                        {/* Show title if it exists and is not empty */}
                        {title && title.trim() !== "" && (
                          <span class="text-base-content/80 mb-1 text-sm font-semibold">
                            {`${title}:`}
                          </span>
                        )}

                        {/* Handle data - check if it's an array (working hours) */}
                        {Array.isArray(data) ? (
                          <div class="text-sm">
                            {data.map((hour: string, idx: number) => (
                              <div
                                data-key={idx}
                                class="text-base-content/70 mb-1"
                              >
                                {hour}
                              </div>
                            ))}
                          </div>
                        ) : (
                          data && (
                            <ContactValue
                              data={data}
                              displayText={displayText}
                              classes="opacity-80 no-underline hover:underline"
                              externalLink={true}
                            />
                          )
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
          </div>
        ))
      }
      <hr />
    </div>
    <div class="mx-auto grid max-w-7xl grid-cols-1 gap-6 md:grid-cols-2">
      <ContactForm />
      <div class="h-[32rem] md:h-full">
        <h2 class="mt-2 mb-2 text-3xl font-bold">Our Location</h2>
        <p class="text-base-content/70">
          See the map below to find us easily. If you have any questions, fill
          out the form and weâ€™ll get back to you as soon as possible.
        </p>
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d2482.4248528798125!2d-0.16113062337891101!3d51.523766971817!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sru!2sua!4v1756731107898!5m2!1sru!2sua"
          title="The location of the company"
          loading="eager"
          width="100%"
          height="79%"
          style="border:0;;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"></iframe>
      </div>
    </div>
  </section>
</Layout>
