---
import { config } from "../../consts";

/**
 * Blog pagination component.
 *
 * Props:
 * - totalPages: total number of pages (number)
 * - currentPage: current page (number)
 * - baseUrl: base URL (e.g. "/blog")
 */
const { totalPages, currentPage, baseUrl = "/blog" } = Astro.props;

// Function to determine which pages to show with "..."
function getPagesToShow(total: number, current: number) {
  const pages = [];

  if (total <= 5) {
    // If there are few pages - show all
    for (let i = 1; i <= total; i++) pages.push(i);
    return pages;
  }

  if (current <= 3) {
    // Start: 1 2 3 4 ... total
    pages.push(1, 2, 3, 4, "dots", total);
    return pages;
  }

  if (current >= total - 2) {
    // End: 1 ... total-3 total-2 total-1 total
    pages.push(1, "dots", total - 3, total - 2, total - 1, total);
    return pages;
  }

  // Middle: 1 ... current-1 current current+1 ... total
  pages.push(1, "dots", current - 1, current, current + 1, "dots", total);
  return pages;
}

const pagesToShow = getPagesToShow(totalPages, currentPage);
---

{
  totalPages > 1 && (
    <nav class="join pt-10" aria-label="Pagination">
      {pagesToShow.map((pageNum, idx) => {
        if (pageNum === "dots") {
          return (
            <span class="join-item btn btn-disabled" aria-hidden="true">
              â€¦
            </span>
          );
        }
        const isActive = pageNum === currentPage;
        const href =
          pageNum === 1
            ? `${config.base}${baseUrl}/`
            : `${config.base}${baseUrl}/${pageNum}/`;
        return (
          <a
            href={href}
            class={`join-item btn ${isActive ? "btn-active" : ""}`}
            aria-current={isActive ? "page" : undefined}
          >
            {pageNum}
          </a>
        );
      })}
    </nav>
  )
}
