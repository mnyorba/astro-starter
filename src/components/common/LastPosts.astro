---
import { getCollection } from "astro:content";
import { config, locale } from "../../consts";

/**
 * Component to get the latest posts from the "blog" collection.
 * Props:
 * - count: number (how many posts to show, default is 3)
 */
const { count = 3 } = Astro.props;

const posts = (await getCollection("blog", ({ data }) => data.draft !== true))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 3);

const title = "Latest Posts";
const description = "The latest updates from our blog.";
---

<section class="mb-8 text-center">
  {title && <h2 class="animate-fade-up mb-2 text-3xl font-bold">{title}</h2>}
  {description && <p class="animate-fade-up mb-8">{description}</p>}
  <div class={`grid gap-6 ${count > 1 ? `grid-cols-${count}` : ""}`}>
    {
      posts.map((post) => (
        <article class="animate-fade-up rounded border p-4 shadow !transition hover:shadow-lg">
          <a href={`${config.base}/blog/${post.id}/`}>
            {post.data.image && (
              <img
                class="h-48 w-full object-cover"
                src={`${config.base}${post.data.image.src}`}
                alt={post.data.image.alt}
                width="720"
                height="360"
              />
            )}
            <h3 class="mb-2 text-xl font-bold">{post.data.title}</h3>
            <p class="mb-2 text-sm opacity-70">
              <time datetime={post.data.publishDate.toISOString()}>
                {post.data.publishDate.toLocaleDateString(
                  locale.date.locale,
                  locale.date.options,
                )}
              </time>
            </p>
            <p class="mb-2">{post.data.description}</p>
          </a>
        </article>
      ))
    }
  </div>
</section>
